var WEB=!0;(function(){var g,a,f,c,v,e,m,l,r,u;e=window.sharejs,c=function(e){var t,n,r,o,i;if(!Array.isArray(e))throw new Error("Op must be an array of components");for(n=null,i=[],r=0,o=e.length;r<o;r++){if("object"==typeof(t=e[r]))if(void 0!==t.i){if(!("string"==typeof t.i&&0<t.i.length||"number"==typeof t.i&&0<t.i))throw new Error("Inserts must insert a string or a +ive number")}else{if(void 0===t.d)throw new Error("Operation component must define .i or .d");if(!("number"==typeof t.d&&0<t.d))throw new Error("Deletes must be a +ive number")}else{if("number"!=typeof t)throw new Error("Op components must be objects or numbers");if(!(0<t))throw new Error("Skip components must be a positive number");if("number"==typeof n)throw new Error("Adjacent skip components should be combined")}i.push(n=t)}return i},(u={name:"text-tp2",tp2:!0,create:function(){return{charLength:0,totalLength:0,positionCache:[],data:[]}},serialize:function(e){if(!e.data)throw new Error("invalid doc snapshot");return e.data},deserialize:function(e){var t,n,r,o;for(r=0,o=((n=u.create()).data=e).length;r<o;r++)"string"==typeof(t=e[r])?(n.charLength+=t.length,n.totalLength+=t.length):n.totalLength+=t;return n}})._takeDoc=l=function(e,t,n,r){var o,i,f;if(t.index>=e.data.length)throw new Error("Operation goes past the end of the document");return f=(i="string"==typeof(o=e.data[t.index])?void 0!==n?o.slice(t.offset,t.offset+n):o.slice(t.offset):void 0===n||r?o-t.offset:Math.min(n,o-t.offset)).length||i,(o.length||o)-t.offset>f?t.offset+=f:(t.index++,t.offset=0),i},u._appendDoc=a=function(e,t){var n;0!==t&&""!==t&&("string"==typeof t?(e.charLength+=t.length,e.totalLength+=t.length):e.totalLength+=t,0===(n=e.data).length?n.push(t):typeof n[n.length-1]==typeof t?n[n.length-1]+=t:n.push(t))},u.apply=function(e,t){var n,r,o,i,f,s,h;if(void 0===e.totalLength||void 0===e.charLength||void 0===e.data.length)throw new Error("Snapshot is invalid");for(c(t),r=u.create(),i={index:0,offset:0},s=0,h=t.length;s<h;s++)if("number"==typeof(n=t[s]))for(f=n;0<f;)o=l(e,i,f),a(r,o),f-=o.length||o;else if(void 0!==n.i)a(r,n.i);else if(void 0!==n.d){for(f=n.d;0<f;)f-=(o=l(e,i,f)).length||o;a(r,n.d)}return r},u._append=g=function(e,t){var n;if(0!==t&&""!==t.i&&0!==t.i&&0!==t.d)return 0===e.length?e.push(t):(n=e[e.length-1],"number"==typeof t&&"number"==typeof n?e[e.length-1]+=t:void 0!==t.i&&null!=n.i&&typeof n.i==typeof t.i?n.i+=t.i:void 0!==t.d&&null!=n.d?n.d+=t.d:e.push(t))},m=function(f){var s,h;return h=s=0,[function(e,t){var n,r,o,i;return s===f.length?null:"number"==typeof(r=o=f[s])||"number"==typeof(r=o.i)||void 0!==(r=o.d)?(null==e||r-h<=e||t&&void 0!==o.i?(n=r-h,++s,h=0):(h+=e,n=e),void 0!==o.i?{i:n}:void 0!==o.d?{d:n}:n):(null==e||o.i.length-h<=e||t?(i={i:o.i.slice(h)},++s,h=0):(i={i:o.i.slice(h,h+e)},h+=e),i)},function(){return f[s]}]},v=function(e){return"number"==typeof e?e:"string"==typeof e.i?e.i.length:e.d||e.i},u.normalize=function(e){var t,n,r,o;for(n=[],r=0,o=e.length;r<o;r++)t=e[r],g(n,t);return n},r=function(e,t,n,r){var o,i,f,s,h,a,l,u,d,p;for(c(e),c(t),s=[],a=(d=m(e))[0],h=d[1],l=0,u=t.length;l<u;l++)if(i=t[l],f=v(i),void 0!==i.i)if(n){if("left"===r)for(;void 0!==(null!=(p=h())?p.i:void 0);)g(s,a());g(s,f)}else for(;0<f;){if(null===(o=a(f,!0)))throw new Error("The transformed op is invalid");if(void 0!==o.d)throw new Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");"number"==typeof o?f-=o:g(s,o)}else for(;0<f;){if(null===(o=a(f,!0)))throw new Error("The op traverses more elements than the document has");g(s,o),o.i||(f-=v(o))}for(;i=a();){if(void 0===i.i)throw new Error("Remaining fragments in the op: "+i);g(s,i)}return s},u.transform=function(e,t,n){if("left"!==n&&"right"!==n)throw new Error("side ("+n+") should be 'left' or 'right'");return r(e,t,!0,n)},u.prune=function(e,t){return r(e,t,!1)},u.compose=function(e,t){var n,r,o,i,f,s,h,a,l;if(null==e)return t;for(c(e),c(t),f=[],s=(l=m(e))[0],l[1],h=0,a=t.length;h<a;h++)if("number"==typeof(o=t[h]))for(i=o;0<i;){if(null===(n=s(i)))throw new Error("The op traverses more elements than the document has");g(f,n),i-=v(n)}else if(void 0!==o.i)g(f,{i:o.i});else for(i=o.d;0<i;){if(null===(n=s(i)))throw new Error("The op traverses more elements than the document has");r=v(n),void 0!==n.i?g(f,{i:r}):g(f,{d:r}),i-=r}for(;o=s();){if(void 0===o.i)throw new Error("Remaining fragments in op1: "+o);g(f,o)}return f},e.types["text-tp2"]=u,u=e.types["text-tp2"],l=u._takeDoc,g=u._append,f=function(e,t,n,r){var o,i;for(i=[];(void 0===r||0<r)&&n.index<t.data.length;)o=l(t,n,r,!0),void 0!==r&&"string"==typeof o&&(r-=o.length),i.push(g(e,o.length||o));return i},u.api={provides:{text:!0},getLength:function(){return this.snapshot.charLength},getText:function(){var o;return function(){var e,t,n,r;for(r=[],e=0,t=(n=this.snapshot.data).length;e<t;e++)"string"==typeof(o=n[e])&&r.push(o);return r}.call(this).join("")},insert:function(e,t,n){var r,o;return void 0===e&&(e=0),r={index:0,offset:0},f(o=[],this.snapshot,r,e),g(o,{i:t}),f(o,this.snapshot,r),this.submitOp(o,n),o},del:function(e,t,n){var r,o,i;for(r={index:0,offset:0},f(o=[],this.snapshot,r,e);0<t;)"string"==typeof(i=l(this.snapshot,r,t,!0))?(g(o,{d:i.length}),t-=i.length):g(o,i);return f(o,this.snapshot,r),this.submitOp(o,n),o},_register:function(){return this.on("remoteop",function(e,t){var n,r,o,i,f,s,h;for(r={index:f=0,offset:0},s=0,h=e.length;s<h;s++)if("number"==typeof(n=e[s]))for(i=n;0<i;)"string"==typeof(o=l(t,r,i))&&(f+=o.length),i-=o.length||o;else if(void 0!==n.i)"string"==typeof n.i&&(this.emit("insert",f,n.i),f+=n.i.length);else for(i=n.d;0<i;)"string"==typeof(o=l(t,r,i))&&this.emit("delete",f,o),i-=o.length||o})}}}).call(this);