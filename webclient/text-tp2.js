!function(){var p,a,f,g,c,l,r,e=window.sharejs,u={name:"text-tp2",tp2:!0,create:function(){return{charLength:0,totalLength:0,positionCache:[],data:[]}},serialize:function(e){if(e.data)return e.data;throw new Error("invalid doc snapshot")},deserialize:function(e){for(var t,n=u.create(),r=0,o=(n.data=e).length;r<o;r++)"string"==typeof(t=e[r])?(n.charLength+=t.length,n.totalLength+=t.length):n.totalLength+=t;return n}},m=function(e){var t,n,r,o,i;if(!Array.isArray(e))throw new Error("Op must be an array of components");for(n=null,i=[],r=0,o=e.length;r<o;r++){if("object"==typeof(t=e[r]))if(void 0!==t.i){if(!("string"==typeof t.i&&0<t.i.length||"number"==typeof t.i&&0<t.i))throw new Error("Inserts must insert a string or a +ive number")}else{if(void 0===t.d)throw new Error("Operation component must define .i or .d");if(!("number"==typeof t.d&&0<t.d))throw new Error("Deletes must be a +ive number")}else{if("number"!=typeof t)throw new Error("Op components must be objects or numbers");if(!(0<t))throw new Error("Skip components must be a positive number");if("number"==typeof n)throw new Error("Adjacent skip components should be combined")}i.push(n=t)}return i};u._takeDoc=l=function(e,t,n,r){if(t.index>=e.data.length)throw new Error("Operation goes past the end of the document");return n=(r="string"==typeof(e=e.data[t.index])?void 0!==n?e.slice(t.offset,t.offset+n):e.slice(t.offset):void 0===n||r?e-t.offset:Math.min(n,e-t.offset)).length||r,(e.length||e)-t.offset>n?t.offset+=n:(t.index++,t.offset=0),r},u._appendDoc=a=function(e,t){0!==t&&""!==t&&("string"==typeof t?(e.charLength+=t.length,e.totalLength+=t.length):e.totalLength+=t,0!==(e=e.data).length&&typeof e[e.length-1]==typeof t?e[e.length-1]+=t:e.push(t))},u.apply=function(e,t){var n,r,o,i,f,s,h;if(void 0===e.totalLength||void 0===e.charLength||void 0===e.data.length)throw new Error("Snapshot is invalid");for(m(t),r=u.create(),i={index:0,offset:0},s=0,h=t.length;s<h;s++)if("number"==typeof(n=t[s]))for(f=n;0<f;)o=l(e,i,f),a(r,o),f-=o.length||o;else if(void 0!==n.i)a(r,n.i);else if(void 0!==n.d){for(f=n.d;0<f;)f-=(o=l(e,i,f)).length||o;a(r,n.d)}return r},u._append=p=function(e,t){var n;if(0!==t&&""!==t.i&&0!==t.i&&0!==t.d)return 0===e.length?e.push(t):(n=e[e.length-1],"number"==typeof t&&"number"==typeof n?e[e.length-1]+=t:void 0!==t.i&&null!=n.i&&typeof n.i==typeof t.i?n.i+=t.i:void 0!==t.d&&null!=n.d?n.d+=t.d:e.push(t))},c=function(f){var s=0,h=0;return[function(e,t){var n,r,o,i;return s===f.length?null:"number"==typeof(r=o=f[s])||"number"==typeof(r=o.i)||void 0!==(r=o.d)?(null==e||r-h<=e||t&&void 0!==o.i?(n=r-h,++s,h=0):(h+=e,n=e),void 0!==o.i?{i:n}:void 0!==o.d?{d:n}:n):(null==e||o.i.length-h<=e||t?(i={i:o.i.slice(h)},++s,h=0):(i={i:o.i.slice(h,h+e)},h+=e),i)},function(){return f[s]}]},g=function(e){return"number"==typeof e?e:"string"==typeof e.i?e.i.length:e.d||e.i},u.normalize=function(e){for(var t,n=[],r=0,o=e.length;r<o;r++)t=e[r],p(n,t);return n},r=function(e,t,n,r){var o,i,f,s,h,a,l,u,d;for(m(e),m(t),s=[],a=(e=c(e))[0],h=e[1],l=0,u=t.length;l<u;l++)if(i=t[l],f=g(i),void 0!==i.i)if(n){if("left"===r)for(;void 0!==(null!=(d=h())?d.i:void 0);)p(s,a());p(s,f)}else for(;0<f;){if(null===(o=a(f,!0)))throw new Error("The transformed op is invalid");if(void 0!==o.d)throw new Error("The transformed op deletes locally inserted characters - it cannot be purged of the insert.");"number"==typeof o?f-=o:p(s,o)}else for(;0<f;){if(null===(o=a(f,!0)))throw new Error("The op traverses more elements than the document has");p(s,o),o.i||(f-=g(o))}for(;i=a();){if(void 0===i.i)throw new Error("Remaining fragments in the op: "+i);p(s,i)}return s},u.transform=function(e,t,n){if("left"!==n&&"right"!==n)throw new Error("side ("+n+") should be 'left' or 'right'");return r(e,t,!0,n)},u.prune=function(e,t){return r(e,t,!1)},u.compose=function(e,t){var n,r,o,i,f,s,h,a;if(null==e)return t;for(m(e),m(t),f=[],s=c(e)[0],h=0,a=t.length;h<a;h++)if("number"==typeof(o=t[h]))for(i=o;0<i;){if(null===(n=s(i)))throw new Error("The op traverses more elements than the document has");p(f,n),i-=g(n)}else if(void 0!==o.i)p(f,{i:o.i});else for(i=o.d;0<i;){if(null===(n=s(i)))throw new Error("The op traverses more elements than the document has");r=g(n),void 0!==n.i?p(f,{i:r}):p(f,{d:r}),i-=r}for(;o=s();){if(void 0===o.i)throw new Error("Remaining fragments in op1: "+o);p(f,o)}return f},e.types["text-tp2"]=u,u=e.types["text-tp2"],l=u._takeDoc,p=u._append,f=function(e,t,n,r){for(var o,i=[];(void 0===r||0<r)&&n.index<t.data.length;)o=l(t,n,r,!0),void 0!==r&&"string"==typeof o&&(r-=o.length),i.push(p(e,o.length||o));return i},u.api={provides:{text:!0},getLength:function(){return this.snapshot.charLength},getText:function(){var o;return function(){for(var e=this.snapshot.data,t=[],n=0,r=e.length;n<r;n++)"string"==typeof(o=e[n])&&t.push(o);return t}.call(this).join("")},insert:function(e,t,n){var r,o;return f(o=[],this.snapshot,r={index:0,offset:0},e=void 0===e?0:e),p(o,{i:t}),f(o,this.snapshot,r),this.submitOp(o,n),o},del:function(e,t,n){var r,o=[],i={index:0,offset:0};for(f(o,this.snapshot,i,e);0<t;)"string"==typeof(r=l(this.snapshot,i,t,!0))?(p(o,{d:r.length}),t-=r.length):p(o,r);return f(o,this.snapshot,i),this.submitOp(o,n),o},_register:function(){return this.on("remoteop",function(e,t){for(var n,r,o,i=0,f={index:0,offset:0},s=0,h=e.length;s<h;s++)if("number"==typeof(n=e[s]))for(o=n;0<o;)"string"==typeof(r=l(t,f,o))&&(i+=r.length),o-=r.length||r;else if(void 0!==n.i)"string"==typeof n.i&&(this.emit("insert",i,n.i),i+=n.i.length);else for(o=n.d;0<o;)"string"==typeof(r=l(t,f,o))&&this.emit("delete",i,r),o-=r.length||r})}}}.call(this);