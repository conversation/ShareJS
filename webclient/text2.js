(function(){var WEB=!0,checkOp,componentLength,exports,makeAppend,makeTake,text2,transformPosition,trim,type;exports=window.sharejs,text2={},text2.name="text2",text2.create=function(){return""},checkOp=function(op){var c,last,_i,_len;if(!Array.isArray(op))throw new Error("Op must be an array of components");last=null;for(_i=0,_len=op.length;_i<_len;_i++){c=op[_i];switch(typeof c){case"object":if(!(typeof c.d=="number"&&c.d>0))throw new Error("Object components must be deletes of size > 0");break;case"string":if(!(c.length>0))throw new Error("Inserts cannot be empty");break;case"number":if(!(c>0))throw new Error("Skip components must be >0");if(typeof last=="number")throw new Error("Adjacent skip components should be combined")}last=c}if(typeof last=="number")throw new Error("Op has a trailing skip")},makeAppend=function(op){return function(component){if(!!component&&component.d!==0)return op.length===0?op.push(component):typeof component==typeof op[op.length-1]?typeof component=="object"?op[op.length-1].d+=component.d:op[op.length-1]+=component:op.push(component)}},makeTake=function(op){var idx,offset,peekType,take;return idx=0,offset=0,take=function(n,indivisableField){var c,part;return idx===op.length?n===-1?null:n:(c=op[idx],typeof c=="number"?n===-1||c-offset<=n?(part=c-offset,++idx,offset=0,part):(offset+=n,n):typeof c=="string"?n===-1||indivisableField==="i"||c.length-offset<=n?(part=c.slice(offset),++idx,offset=0,part):(part=c.slice(offset,offset+n),offset+=n,part):n===-1||indivisableField==="d"||c.d-offset<=n?(part={d:c.d-offset},++idx,offset=0,part):(offset+=n,{d:n}))},peekType=function(){return op[idx]},[take,peekType]},componentLength=function(c){return typeof c=="number"?c:c.length||c.d},trim=function(op){return op.length>0&&typeof op[op.length-1]=="number"&&op.pop(),op},text2.normalize=function(op){var append,component,newOp,_i,_len;newOp=[],append=makeAppend(newOp);for(_i=0,_len=op.length;_i<_len;_i++)component=op[_i],append(component);return trim(newOp)},text2.apply=function(str,op){var component,newDoc,pos,_i,_len;if(typeof str!="string")throw new Error("Snapshot should be a string");checkOp(op),pos=0,newDoc=[];for(_i=0,_len=op.length;_i<_len;_i++){component=op[_i];switch(typeof component){case"number":if(component>str.length)throw new Error("The op is too long for this document");newDoc.push(str.slice(0,component)),str=str.slice(component);break;case"string":newDoc.push(component);break;case"object":str=str.slice(component.d)}}return newDoc.join("")+str},text2.transform=function(op,otherOp,side){var append,chunk,component,length,newOp,o,peek,take,_i,_len,_ref;if(side!=="left"&&side!=="right")throw new Error("side ("+side+") must be 'left' or 'right'");checkOp(op),checkOp(otherOp),newOp=[],append=makeAppend(newOp),_ref=makeTake(op),take=_ref[0],peek=_ref[1];for(_i=0,_len=otherOp.length;_i<_len;_i++){component=otherOp[_i];switch(typeof component){case"number":length=component;while(length>0)chunk=take(length,"i"),append(chunk),typeof chunk!="string"&&(length-=componentLength(chunk));break;case"string":side==="left"&&(o=peek(),typeof o=="string"&&append(take(-1))),append(component.length);break;case"object":length=component.d;while(length>0){chunk=take(length,"i");switch(typeof chunk){case"number":length-=chunk;break;case"string":append(chunk);break;case"object":length-=chunk.d}}}}while(component=take(-1))append(component);return trim(newOp)},text2.compose=function(op1,op2){var append,chunk,component,length,result,take,_,_i,_len,_ref;checkOp(op1),checkOp(op2),result=[],append=makeAppend(result),_ref=makeTake(op1),take=_ref[0],_=_ref[1];for(_i=0,_len=op2.length;_i<_len;_i++){component=op2[_i];switch(typeof component){case"number":length=component;while(length>0)chunk=take(length,"d"),append(chunk),typeof chunk!="object"&&(length-=componentLength(chunk));break;case"string":append(component);break;case"object":length=component.d;while(length>0){chunk=take(length,"d");switch(typeof chunk){case"number":append({d:chunk}),length-=chunk;break;case"string":length-=chunk.length;break;case"object":append(chunk)}}}}while(component=take(-1))append(component);return trim(result)},transformPosition=function(cursor,op){var c,pos,_i,_len;pos=0;for(_i=0,_len=op.length;_i<_len;_i++){c=op[_i];if(cursor<=pos)break;switch(typeof c){case"number":if(cursor<=pos+c)return cursor;pos+=c;break;case"string":pos+=c.length,cursor+=c.length;break;case"object":cursor-=Math.min(c.d,cursor-pos)}}return cursor},text2.transformCursor=function(cursor,op,isOwnOp){var c,pos,_i,_len;pos=0;if(isOwnOp){for(_i=0,_len=op.length;_i<_len;_i++){c=op[_i];switch(typeof c){case"number":pos+=c;break;case"string":pos+=c.length}}return[pos,pos]}return[transformPosition(cursor[0],op),transformPosition(cursor[1],op)]},typeof WEB!="undefined"&&WEB!==null?exports.types.text2=text2:module.exports=text2,typeof WEB!="undefined"&&WEB!==null?type=exports.types.text2:type=require("./text2"),type.api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(pos,text,callback){var op;return op=type.normalize([pos,text]),this.submitOp(op,callback),op},del:function(pos,length,callback){var op;return op=type.normalize([pos,{d:length}]),this.submitOp(op,callback),op},_register:function(){return this.on("remoteop",function(op,snapshot){var component,pos,spos,_i,_len,_results;pos=spos=0,_results=[];for(_i=0,_len=op.length;_i<_len;_i++){component=op[_i];switch(typeof component){case"number":pos+=component,_results.push(spos+=component);break;case"string":this.emit("insert",pos,component),_results.push(pos+=component.length);break;case"object":this.emit("delete",pos,snapshot.slice(spos,spos+component.d)),_results.push(spos+=component.d);break;default:_results.push(void 0)}}return _results})}}}).call(this)