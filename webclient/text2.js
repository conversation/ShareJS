!function(){var c,n,e=window.sharejs,t={name:"text2",create:function(){return""}},p=function(e){var t,r,n,o;if(!Array.isArray(e))throw new Error("Op must be an array of components");for(r=null,n=0,o=e.length;n<o;n++){switch(typeof(t=e[n])){case"object":if("number"==typeof t.d&&0<t.d)break;throw new Error("Object components must be deletes of size > 0");case"string":if(0<t.length)break;throw new Error("Inserts cannot be empty");case"number":if(!(0<t))throw new Error("Skip components must be >0");if("number"==typeof r)throw new Error("Adjacent skip components should be combined")}r=t}if("number"==typeof r)throw new Error("Op has a trailing skip")},b=function(t){return function(e){if(e&&0!==e.d)return 0!==t.length&&typeof e==typeof t[t.length-1]?"object"==typeof e?t[t.length-1].d+=e.d:t[t.length-1]+=e:t.push(e)}},l=function(o){var s=0,i=0;return[function(e,t){var r,n;return s===o.length?-1===e?null:e:"number"==typeof(r=o[s])?-1===e||r-i<=e?(n=r-i,++s,i=0,n):(i+=e,e):"string"==typeof r?(-1===e||"i"===t||r.length-i<=e?(n=r.slice(i),++s,i=0):(n=r.slice(i,i+e),i+=e),n):-1===e||"d"===t||r.d-i<=e?(n={d:r.d-i},++s,i=0,n):(i+=e,{d:e})},function(){return o[s]}]},g=function(e){return"number"==typeof e?e:e.length||e.d},m=function(e){return 0<e.length&&"number"==typeof e[e.length-1]&&e.pop(),e};t.normalize=function(e){for(var t=[],r=b(t),n=0,o=e.length;n<o;n++)r(e[n]);return m(t)},t.apply=function(e,t){var r,n,o,s;if("string"!=typeof e)throw new Error("Snapshot should be a string");for(p(t),n=[],o=0,s=t.length;o<s;o++)switch(typeof(r=t[o])){case"number":if(r>e.length)throw new Error("The op is too long for this document");n.push(e.slice(0,r)),e=e.slice(r);break;case"string":n.push(r);break;case"object":e=e.slice(r.d)}return n.join("")+e},t.transform=function(e,t,r){var n,o,s,i,c,a,f,u,h;if("left"!==r&&"right"!==r)throw new Error("side ("+r+") must be 'left' or 'right'");for(p(e),p(t),n=b(c=[]),f=(e=l(e))[0],a=e[1],u=0,h=t.length;u<h;u++)switch(typeof(s=t[u])){case"number":for(i=s;0<i;)n(o=f(i,"i")),"string"!=typeof o&&(i-=g(o));break;case"string":"left"===r&&"string"==typeof a()&&n(f(-1)),n(s.length);break;case"object":for(i=s.d;0<i;)switch(typeof(o=f(i,"i"))){case"number":i-=o;break;case"string":n(o);break;case"object":i-=o.d}}for(;s=f(-1);)n(s);return m(c)},t.compose=function(e,t){var r,n,o,s,i,c,a,f;for(p(e),p(t),r=b(i=[]),c=l(e)[0],a=0,f=t.length;a<f;a++)switch(typeof(o=t[a])){case"number":for(s=o;0<s;)r(n=c(s,"d")),"object"!=typeof n&&(s-=g(n));break;case"string":r(o);break;case"object":for(s=o.d;0<s;)switch(typeof(n=c(s,"d"))){case"number":r({d:n}),s-=n;break;case"string":s-=n.length;break;case"object":r(n)}}for(;o=c(-1);)r(o);return m(i)},c=function(e,t){for(var r,n=0,o=0,s=t.length;o<s&&(r=t[o],!(e<=n));o++)switch(typeof r){case"number":if(e<=n+r)return e;n+=r;break;case"string":n+=r.length,e+=r.length;break;case"object":e-=Math.min(r.d,e-n)}return e},t.transformCursor=function(e,t,r){var n,o,s,i=0;if(r){for(o=0,s=t.length;o<s;o++)switch(typeof(n=t[o])){case"number":i+=n;break;case"string":i+=n.length}return[i,i]}return[c(e[0],t),c(e[1],t)]},e.types.text2=t,(n=e.types.text2).api={provides:{text:!0},getLength:function(){return this.snapshot.length},getText:function(){return this.snapshot},insert:function(e,t,r){e=n.normalize([e,t]);return this.submitOp(e,r),e},del:function(e,t,r){e=n.normalize([e,{d:t}]);return this.submitOp(e,r),e},_register:function(){return this.on("remoteop",function(e,t){for(var r,n,o=n=0,s=[],i=0,c=e.length;i<c;i++)switch(typeof(r=e[i])){case"number":o+=r,s.push(n+=r);break;case"string":this.emit("insert",o,r),s.push(o+=r.length);break;case"object":this.emit("delete",o,t.slice(n,n+r.d)),s.push(n+=r.d);break;default:s.push(void 0)}return s})}}}.call(this);